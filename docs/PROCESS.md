# Процесс разработки (Craftsman, “Spec‑Lite”)

Цель этого процесса — держать MVP стабильным, а изменения предсказуемыми: меньше “хаоса”, меньше регрессий, быстрее результат.

Мы **не внедряем Spec Kit как зависимость/CLI**. Мы берём только полезные идеи (спека → план → задачи → проверки) и фиксируем их в документах репозитория.

## Быстрый старт (как работать с новой задачей)
0) **Два режима: ChatGPT → Codex**
- В **ChatGPT (Чат)**: готовим ТЗ/план/проверки и уточняем детали. **Код/файлы не меняем**.
- В **Codex (Агент)**: по готовому ТЗ **правим репозиторий по умолчанию**, этапами, с проверками из ТЗ.
- Коммиты/push: делаете **вы вручную**, если отдельно не попросили агента сделать commit/push.

1) **Сформулировать ТЗ**
- Создать ТЗ по шаблону: `docs/templates/FEATURE_TZ.md` (или через brain: `npm run brain:new-task -- "Название задачи"`)
- Перед реализацией (и даже перед финализацией ТЗ) — быстро проверить референсы: `npm run brain:refs -- "ключевые слова"`
- Если чего‑то не хватает — максимум **3 уточняющих вопроса** (только high‑impact). Подсказки: `docs/templates/CLARIFY_QUESTIONS.md`.
- Если вы просто написали задачу в ChatGPT (без файла ТЗ), ChatGPT‑агент **сам** должен:
  - создать `docs/tasks/...` через `npm run brain:new-task -- "..."`,
  - заполнить черновик ТЗ,
  - задать до 3 уточняющих вопросов,
  - и только потом начинать кодинг.

2) **Разбить на этапы**
- Любые изменения “ядра” (редактор/рендер/undo/сохранение) — **только этапами**.
- Для каждого этапа: что меняем + какие ручные проверки делаем сразу.

3) **Сделать промежуточные проверки**
- Использовать чеклист регрессий: `docs/templates/REGRESSION_CHECKLIST.md`
- Проверять после каждого этапа (минимально), и после завершения (полностью).

4) **Зафиксировать решения**
- Коротко записать итог (2–5 буллетов) в `docs/WORKLOG.md`.
- Если решение/правило будет “долго жить” — добавить/обновить `docs/CONTEXT.md`.

## Git “save points” (коммиты как точки сохранения)
Чтобы не терять прогресс и легко откатываться:
- После **каждого этапа**, когда промежуточные проверки пройдены — делаем **один небольшой коммит**.
- Если этап затронул много файлов, лучше разбить на 2–3 коммита по смыслу (но не “всё сразу одним коммитом”).
- Сообщение коммита должно быть понятным без чата. Пример: `editor: stage 2 paragraph render` или `toolbar: compact mode toggle`.
- Для экспериментов — отдельная ветка (или worktree), чтобы не пачкать стабильную историю.

## Где что хранить
- **Постоянный контекст проекта** (устойчивые правила/ограничения/текущее состояние): `docs/CONTEXT.md`
- **Хронология** (что сделали/почему/что дальше): `docs/WORKLOG.md`
- **ТЗ по задачам** (рабочие файлы): `docs/tasks/YYYY-MM-DD--short-name.md`
- **Шаблон ТЗ**: `docs/templates/FEATURE_TZ.md`
- **Шаблон ТЗ для “ядра редактора”**: `docs/templates/EDITOR_CORE_TZ.md`
- **Шаблон регресс‑проверок**: `docs/templates/REGRESSION_CHECKLIST.md`
- **Референсы/методологии** (как источник идей, не как код): `docs/references/*` (см. `docs/references/INDEX.md`)

## Brain (утилиты “мозга проекта”)
Команды (все оффлайн, без зависимостей):
- `npm run brain:status` — быстрый срез состояния (CONTEXT + последний WORKLOG + список задач).
- `npm run brain:handoff` — генерирует `docs/HANDOFF.md` для передачи контекста новому агенту.
- `npm run brain:log -- "..."` — добавляет пункт в `docs/WORKLOG.md` под сегодняшней датой.
- `npm run brain:new-task -- "..."` — создаёт новый файл ТЗ в `docs/tasks/` из шаблона.
- `npm run brain:savepoint -- "..."` — подсказывает, как сделать аккуратный git‑коммит после этапа.
- `npm run brain:refs -- "..."` — быстро подсказывает, какие референсы/паттерны уже есть в `docs/references`.

## Референсы (open-source проекты)
Если используем чужие проекты как источник идей:
- Перед началом фичи/задачи запускаем: `npm run brain:refs -- "ключевые слова"` и добавляем релевантные ссылки в ТЗ.
- Делаем заметку в `docs/references/projects/…` по шаблону.
- Проверяем лицензию (см. `docs/references/CHECKLIST.md`): GPL/AGPL → только идеи, без копирования кода.
- В ТЗ на фичу добавляем ссылку на конкретную заметку (чтобы агент мог быстро свериться).

## Правило “отклонений от плана”
Если новая задача не укладывается в текущий план — используем протокол из `docs/CONTEXT.md` (раздел “Протокол отклонений от плана”).

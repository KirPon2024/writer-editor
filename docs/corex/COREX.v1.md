# COREX v1 — YALKEN / Writer-Editor

Статус: **FROZEN**

COREX — каноническая энциклопедия проекта:
- философия (что это за продукт по сути)
- целевая архитектурная модель (куда хотим прийти)
- долгосрочный вектор развития (горизонт)

COREX:
- **не управляет кодом напрямую**
- **не является текущим ТЗ**
- описывает **целевую модель**, а не текущее состояние реализации

## Иерархия источников истины (жёстко)
1. `CANON.md` — верховный закон проекта (правила, запреты, приоритеты)
2. `docs/corex/COREX.vN.md` — философия + целевая архитектура + долгий горизонт
3. `docs/BIBLE.md` — дорожная карта и текущая реализация
4. Остальные `docs/**` — справочные материалы

Правило конфликта: при любом противоречии **`CANON.md` имеет приоритет** над COREX и BIBLE.

## 0) Статус и правила изменения
- COREX — версионированный документ.
- Любые изменения COREX делаются **только выпуском новой версии**: `COREX.v2.md`, `COREX.v3.md`, ...
- Каждая версия фиксируется в `docs/corex/CHANGELOG.md` (причина / эффект / rollback).

## 1) Философия проекта (жёстко)

### 1.1 Сущностное определение
YALKEN — это **среда мышления и письма**, а не “редактор функций” и не IDE.

### 1.2 Базовые принципы
- письмо = процесс мышления
- текст = живое состояние, а не файл
- архитектура = инструмент свободы, а не ограничение
- пользователь = соавтор среды
- сложность появляется только по запросу

### 1.3 Ключевая ценность
**Максимальная гибкость при минимальной хрупкости.**

## 2) Манифест-формула (канон)

**Неподвижное Ядро**
-> Порты / Контракты
-> Архитектурный слой (команды, режимы)
-> Плагины
-> UI Runtime
-> Skin / Theme

## 3) Законы системы (не нарушаются)
- ядро не знает UI
- UI не знает файловую систему
- плагины не знают платформу
- всё общается через контракты
- никаких скрытых побочных эффектов
- любое расширение изолировано
- любые изменения обратимы

## 4) Экзистенциальный модуль (X-Module)

### 4.1 Назначение
Обеспечить письмо как практику проживания смысла, а не как манипуляцию интерфейсом.

### 4.2 Режимы присутствия
- **Minimal** — текст и тишина
- **Workbench** — структура, навигация, ремесло
- **Studio** — плагины, анализ, экспорт

### 4.3 Ритуалы
- начало (чистая сессия)
- возвращение (контекст)
- фиксация (ревизия)

### 4.4 Канон доверия к тексту
- текст живёт в движке
- сохранение только через контракты
- скрытые конверсии запрещены

## 5) Архитектурная модель

### 5.1 Инвариант (неподвижно)
- Core
- модель данных
- контракты
- безопасность
- source of truth

### 5.2 Эволюционное (изменяемо)
- команды
- режимы
- панели
- хоткеи
- плагины
- UI-конфигурации

## 6) Слои системы

### 6.1 Core
- Document
- Project
- Node
- Workspace
- Session
- Revision / Snapshot
- ModeProfile

### 6.2 Platform Shell
- Electron (текущая)
- Web / Native (будущие)
- адаптеры платформы

### 6.3 Boundary / Ports
- IPC
- DTO
- Event Bus

### 6.4 Plugin Runtime
- sandbox
- permissions
- lifecycle
- crash isolation

### 6.5 UI Runtime
- панели
- вкладки
- command palette
- состояния UX

### 6.6 Skin / Theme
- типографика
- визуальные системы
- скины поверх UI Runtime

## 7) Командная модель (канон)
- всё = команда
- каждая функция — именованная команда
- UI только вызывает команды
- плагины только регистрируют команды
- режимы управляют доступностью команд

## 8) Режимы как профили
`Mode = enabledPlugins + uiLayout + keymap + settingsPreset`

- режимы декларативны
- переключаемы без пересборки
- изменения атомарны и обратимы

## 9) Плагинная система

### 9.1 Формат
- manifest
- entry
- permissions
- contributions

### 9.2 Возможности плагина
- команды
- меню
- панели
- хоткеи
- настройки

### 9.3 Ограничения
- нет прямого доступа к ядру
- нет прямого доступа к платформе
- только через разрешённые порты

## 10) Архитектура изменения (ключевой слой)
- архитектура описывается как данные
- изменения архитектуры:
  - сохраняются
  - версионируются
  - откатываются
- архитектура = объект проектирования

## 11) Архитектура эволюции пользователя
- Beginner -> Intermediate -> Master
- сложность раскрывается постепенно
- система управляет когнитивной нагрузкой

## 12) Архитектурная память
- история режимов
- история плагинов
- история конфигураций
- восстановление рабочих эпох

## 13) Дорожная карта реализации (горизонт)

### M2 — Text Skeleton + IPC
- TipTap skeleton
- IPC getText
- безопасность
- статус: CLOSED

### M2.5 — Контракты и границы
- CommandRegistry
- TextProvider
- FileSystemPort
- DialogPort
- без UI и плагинов

### M3 — File I/O
- Save / Save As / Open
- dialog choose path
- backup hooks

### M4 — Command System
- единый реестр
- хоткеи = команды
- меню = команды

### M5 — Режимы
- Minimal
- Workbench
- ModeProfile

### M6 — Plugin Runtime v1
- plugins/
- manifest
- sandbox
- safe mode

### M7 — UI Runtime стабилизация
- панели
- layouts
- command palette

### M8 — Дизайн и UX
- после архитектурной стабилизации
- минимализм как режим

## 14) Кроссплатформенная стратегия

### 14.1 Порядок адаптации
1. macOS — эталонная реализация
2. Windows
3. Linux
4. Web
5. Mobile (iOS / Android)

### 14.2 Принцип
- ядро общее
- платформы = адаптеры
- UI повторно используем
- логика не дублируется

## 15) Итоговая формула
**Core — вечен**
**Архитектура — конфигурируема**
**Функции — плагины**
**Режимы — профили**
**UI — сменяем**
**Изменения — обратимы**

## 16) Нейминг (политика)
- В COREX фиксируется философское имя: **YALKEN / Writer-Editor**
- В коде и сборках временно сохраняется текущее имя (**craftsman**)
- Переименование — отдельный этап, не раньше стабилизации архитектуры (после M3-M4)

